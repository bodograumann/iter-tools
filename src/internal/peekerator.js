/* @macrome
 * @generatedby /generate/generators/impls/index.cjs
 * @generatedfrom ./$peekerator.js#1649955189473
 * This file is autogenerated. Please do not edit it directly.
 * When editing run `npx macrome watch` then change the file this is generated from.
 */
import { ensureIterable, callReturn } from './iterable.js';

const _ = Symbol.for('_');

class PeekeratorIterator {
  constructor(peekr) {
    this.peekr = peekr;
  }

  next() {
    const { peekr } = this;
    const { current } = peekr;
    peekr.advance();
    return current;
  }

  return() {
    this.peekr.return();
    return { value: undefined, done: true };
  }

  [Symbol.iterator]() {
    return this;
  }
}

export class Peekerator {
  static from(iterable, ...args) {
    const iterator = ensureIterable(iterable)[Symbol.iterator]();
    const first = iterator.next();
    return new this(iterator, first, ...args);
  }

  constructor(iterator, first) {
    this[_] = {
      iterator,
      current: first,
      index: 0,
    };
  }

  get current() {
    return this[_].current;
  }

  get value() {
    return this[_].current.value;
  }

  get done() {
    return this[_].current.done;
  }

  get index() {
    return this[_].index;
  }

  advance() {
    {
      const this_ = this[_];

      if (!this_.current.done) {
        this_.current = this_.iterator.next();
        this_.index++;
      }

      return this;
    }
  }

  return() {
    const this_ = this[_];
    if (!this.done) {
      callReturn(this_.iterator);
    }
    this_.current = { value: undefined, done: true };
    return this;
  }

  asIterator() {
    return new PeekeratorIterator(this);
  }
}
